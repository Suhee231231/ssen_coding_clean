<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´€ë¦¬ì í˜ì´ì§€ | SSEN CODING</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    <link rel="apple-touch-icon" href="/favicon.ico">
    <link rel="stylesheet" href="/css/style.css?v=1.1">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@200;300;400;500;600;700;900&display=swap" rel="stylesheet">
    <script>
      (function(d) {
        var config = {
          kitId: 'web7wnn',
          scriptTimeout: 3000,
          async: true
        },
        h=d.documentElement,t=setTimeout(function(){h.className=h.className.replace(/\bwf-loading\b/g,"")+" wf-inactive";},config.scriptTimeout),tk=d.createElement("script"),f=false,s=d.getElementsByTagName("script")[0],a;h.className+=" wf-loading";tk.src='https://use.typekit.net/'+config.kitId+'.js';tk.async=true;tk.onload=tk.onreadystatechange=function(){a=this.readyState;if(f||a&&a!="complete"&&a!="loaded")return;f=true;clearTimeout(t);try{Typekit.load(config)}catch(e){}};s.parentNode.insertBefore(tk,s)
      })(document);
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/monokai.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/python/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/sql/sql.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/clike/clike.min.js"></script>
    <style>
        /* ì „ì²´ ê´€ë¦¬ì í˜ì´ì§€ì— Noto Serif KR í°íŠ¸ ì ìš© */
        body {
            font-family: 'Noto Serif KR', serif !important;
            font-weight: 400;
            line-height: 1.6;
        }
        
        /* ì œëª©ë“¤ì— ë” êµµì€ í°íŠ¸ ì ìš© */
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Noto Serif KR', serif !important;
            font-weight: 600;
        }
        
        /* ë²„íŠ¼ê³¼ ì…ë ¥ ìš”ì†Œë“¤ */
        button, input, select, textarea {
            font-family: 'Noto Serif KR', serif !important;
            font-weight: 400;
        }
        
        /* ì½”ë“œ í¸ì§‘ê¸°ëŠ” ëª¨ë…¸ìŠ¤í˜ì´ìŠ¤ í°íŠ¸ ìœ ì§€ */
        .CodeMirror {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace !important;
        }
        
        /* ë„¤ë¹„ê²Œì´ì…˜ ë¡œê³ ëŠ” ê¸°ì¡´ í°íŠ¸ ìœ ì§€ */
        .logo {
            font-family: 'Asta Sans', sans-serif !important;
        }
        
        .admin-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .admin-header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }
        
        .admin-header h1 {
            font-weight: 700;
            letter-spacing: -0.5px;
        }
        
        .admin-header p {
            font-weight: 300;
            opacity: 0.9;
        }
        
        .admin-tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 2px solid #ecf0f1;
        }
        
        .admin-tab {
            padding: 15px 30px;
            background: #ecf0f1;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s;
            letter-spacing: 0.3px;
        }
        
        .admin-tab.active {
            background: #00d4aa;
            color: #1a1a1a;
        }
        
        .admin-tab:hover {
            background: #00d4aa;
            color: #1a1a1a;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .problem-form {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #2c3e50;
            letter-spacing: 0.2px;
        }
        
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ecf0f1;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #00d4aa;
        }
        
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .code-editor-container {
            border: 1px solid #ddd;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .code-editor-header {
            background: #f8f9fa;
            padding: 8px 12px;
            border-bottom: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .code-editor-header select {
            padding: 4px 8px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 12px;
        }
        
        .CodeMirror {
            height: 200px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
        }
        
        .option-code-editor {
            margin-top: 10px;
        }
        
        .option-code-editor .CodeMirror {
            height: 120px;
        }
        
        .code-preview {
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            margin-top: 10px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .code-preview pre {
            margin: 0;
            white-space: pre-wrap;
        }
        
        .btn-primary {
            background: #00d4aa;
            color: #1a1a1a;
            padding: 12px 30px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            letter-spacing: 0.3px;
        }
        
        .btn-primary:hover {
            background: #00b894;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 212, 170, 0.3);
        }
        
        .btn-danger {
            background: #e74c3c;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .btn-danger:hover {
            background: #c0392b;
        }
        
        .btn-danger:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }
        
        .btn-danger:disabled:hover {
            background: #bdc3c7;
        }
        
        .subjects-order-list {
            margin-top: 15px;
        }
        
        .subject-order-item {
            background: white;
            padding: 15px;
            border: 2px solid #ecf0f1;
            border-radius: 6px;
            margin-bottom: 10px;
            cursor: move;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s;
        }
        
        .subject-order-item:hover {
            border-color: #00d4aa;
            box-shadow: 0 2px 8px rgba(0, 212, 170, 0.2);
        }
        
        .subject-order-item.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }
        
        .subject-order-handle {
            cursor: move;
            color: #7f8c8d;
            margin-right: 15px;
            font-size: 18px;
        }
        
        .subject-order-info {
            flex: 1;
        }
        
        .subject-order-info h4 {
            margin: 0 0 5px 0;
            color: #2c3e50;
        }
        
        .subject-order-info p {
            margin: 0;
            color: #7f8c8d;
            font-size: 14px;
        }
        
        .subject-order-number {
            background: #00d4aa;
            color: #1a1a1a;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-left: 15px;
        }
        
        .problems-list {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .problem-item {
            padding: 20px;
            border-bottom: 1px solid #ecf0f1;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .problem-item:last-child {
            border-bottom: none;
        }
        
        .problem-info h4 {
            margin: 0 0 8px 0;
            color: #2c3e50;
            font-weight: 600;
            line-height: 1.4;
        }
        
        .problem-info p {
            margin: 0;
            color: #7f8c8d;
            font-size: 14px;
            line-height: 1.5;
            font-weight: 300;
        }
        
        .problem-actions {
            display: flex;
            gap: 10px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .stat-number {
            font-size: 2.5em;
            font-weight: 700;
            color: #00d4aa;
            margin-bottom: 10px;
            letter-spacing: -1px;
        }
        
        .stat-label {
            color: #7f8c8d;
            font-size: 14px;
            font-weight: 400;
            letter-spacing: 0.3px;
        }
        
        .error-message {
            background: #e74c3c;
            color: white;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        
        .success-message {
            background: #27ae60;
            color: white;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        
        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }
        
        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 0;
            border: none;
            border-radius: 8px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        
        .modal-header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            border-radius: 8px 8px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            margin: 0;
        }
        
        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s;
        }
        
        .close:hover {
            color: white;
        }
        
        .modal-body {
            padding: 30px;
        }
        
        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 30px;
        }
        
        .btn-secondary {
            background: #95a5a6;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            letter-spacing: 0.3px;
        }
        
        .btn-secondary:hover {
            background: #7f8c8d;
        }
        
        .btn-secondary:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .btn-secondary:disabled:hover {
            background: #bdc3c7;
        }
        
        #pagination {
            border-top: 1px solid #ecf0f1;
            padding-top: 20px;
        }
        
        #pagination button {
            min-width: 80px;
        }
        
        #gotoPage {
            border: 2px solid #ecf0f1;
            border-radius: 4px;
            text-align: center;
        }
        
        #gotoPage:focus {
            outline: none;
            border-color: #00d4aa;
        }
    </style>
</head>
<body>
    <header>
        <nav>
            <div class="nav-container">
                <h1 class="logo"><a href="/" style="text-decoration: none; color: inherit;"><span class="logo-highlight">SSEN</span><span class="logo-underline">C</span>ODING</a></h1>
                <div class="nav-links">
                    <a href="/">í™ˆìœ¼ë¡œ</a>
                    <a href="#" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</a>
                </div>
            </div>
        </nav>
    </header>

    <main class="admin-container">
        <div class="admin-header">
            <h1>ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h1>
            <p>ì½”ë”© ë¬¸ì œë¥¼ ê´€ë¦¬í•˜ê³  ìƒˆë¡œìš´ ë¬¸ì œë¥¼ ì¶”ê°€í•˜ì„¸ìš”.</p>
        </div>

        <div id="messageContainer"></div>

        <div class="admin-tabs">
            <button class="admin-tab active" onclick="showTab('dashboard')">ëŒ€ì‹œë³´ë“œ</button>
            <button class="admin-tab" onclick="showTab('add-problem')">ë¬¸ì œ ì¶”ê°€</button>
            <button class="admin-tab" onclick="showTab('manage-problems')">ë¬¸ì œ ê´€ë¦¬</button>
            <button class="admin-tab" onclick="showTab('manage-subjects')">ê³¼ëª© ê´€ë¦¬</button>
            <button class="admin-tab" onclick="showTab('change-password')">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</button>
        </div>

        <!-- ëŒ€ì‹œë³´ë“œ íƒ­ -->
        <div id="dashboard" class="tab-content active">
            <div class="stats-grid" id="statsGrid">
                <!-- í†µê³„ê°€ ì—¬ê¸°ì— ë¡œë“œë©ë‹ˆë‹¤ -->
            </div>
        </div>

        <!-- ë¬¸ì œ ì¶”ê°€ íƒ­ -->
        <div id="add-problem" class="tab-content">
            <div class="problem-form">
                <h3>ìƒˆ ë¬¸ì œ ì¶”ê°€</h3>
                <form id="addProblemForm">
                    <div class="form-group">
                        <label for="subject">ê³¼ëª© ì„ íƒ</label>
                        <select id="subject" name="subject" required onchange="updateCodeMode()">
                            <option value="">ê³¼ëª©ì„ ì„ íƒí•˜ì„¸ìš”</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="question">ë¬¸ì œ</label>
                        <div class="code-editor-container">
                            <div class="code-editor-header">
                                <span>ë¬¸ì œ í…ìŠ¤íŠ¸</span>
                                <button type="button" onclick="toggleCodeEditor('question')" style="padding: 4px 8px; font-size: 12px; background: #00d4aa; color: white; border: none; border-radius: 3px; cursor: pointer;">ì½”ë“œ ì—ë””í„°</button>
                            </div>
                            <textarea id="question" name="question" required placeholder="ë¬¸ì œë¥¼ ì…ë ¥í•˜ì„¸ìš”. ì½”ë“œê°€ í¬í•¨ëœ ê²½ìš° ì½”ë“œ ì—ë””í„°ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”."></textarea>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="option_a">1ë²ˆ</label>
                        <div class="code-editor-container">
                            <div class="code-editor-header">
                                <span>1ë²ˆ í…ìŠ¤íŠ¸</span>
                                <button type="button" onclick="toggleCodeEditor('option_a')" style="padding: 4px 8px; font-size: 12px; background: #00d4aa; color: white; border: none; border-radius: 3px; cursor: pointer;">ì½”ë“œ ì—ë””í„°</button>
                            </div>
                            <textarea id="option_a" name="option_a" required placeholder="1ë²ˆì„ ì…ë ¥í•˜ì„¸ìš”. ì½”ë“œê°€ í¬í•¨ëœ ê²½ìš° ì½”ë“œ ì—ë””í„°ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”."></textarea>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="option_b">2ë²ˆ</label>
                        <div class="code-editor-container">
                            <div class="code-editor-header">
                                <span>2ë²ˆ í…ìŠ¤íŠ¸</span>
                                <button type="button" onclick="toggleCodeEditor('option_b')" style="padding: 4px 8px; font-size: 12px; background: #00d4aa; color: white; border: none; border-radius: 3px; cursor: pointer;">ì½”ë“œ ì—ë””í„°</button>
                            </div>
                            <textarea id="option_b" name="option_b" required placeholder="2ë²ˆì„ ì…ë ¥í•˜ì„¸ìš”. ì½”ë“œê°€ í¬í•¨ëœ ê²½ìš° ì½”ë“œ ì—ë””í„°ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”."></textarea>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="option_c">3ë²ˆ</label>
                        <div class="code-editor-container">
                            <div class="code-editor-header">
                                <span>3ë²ˆ í…ìŠ¤íŠ¸</span>
                                <button type="button" onclick="toggleCodeEditor('option_c')" style="padding: 4px 8px; font-size: 12px; background: #00d4aa; color: white; border: none; border-radius: 3px; cursor: pointer;">ì½”ë“œ ì—ë””í„°</button>
                            </div>
                            <textarea id="option_c" name="option_c" required placeholder="3ë²ˆì„ ì…ë ¥í•˜ì„¸ìš”. ì½”ë“œê°€ í¬í•¨ëœ ê²½ìš° ì½”ë“œ ì—ë””í„°ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”."></textarea>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="option_d">4ë²ˆ</label>
                        <div class="code-editor-container">
                            <div class="code-editor-header">
                                <span>4ë²ˆ í…ìŠ¤íŠ¸</span>
                                <button type="button" onclick="toggleCodeEditor('option_d')" style="padding: 4px 8px; font-size: 12px; background: #00d4aa; color: white; border: none; border-radius: 3px; cursor: pointer;">ì½”ë“œ ì—ë””í„°</button>
                            </div>
                            <textarea id="option_d" name="option_d" required placeholder="4ë²ˆì„ ì…ë ¥í•˜ì„¸ìš”. ì½”ë“œê°€ í¬í•¨ëœ ê²½ìš° ì½”ë“œ ì—ë””í„°ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”."></textarea>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="correct_answer">ì •ë‹µ</label>
                        <select id="correct_answer" name="correct_answer" required>
                            <option value="">ì •ë‹µì„ ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="explanation">í•´ì„¤</label>
                        <div class="code-editor-container">
                            <div class="code-editor-header">
                                <span>í•´ì„¤ í…ìŠ¤íŠ¸</span>
                                <button type="button" onclick="toggleCodeEditor('explanation')" style="padding: 4px 8px; font-size: 12px; background: #00d4aa; color: white; border: none; border-radius: 3px; cursor: pointer;">ì½”ë“œ ì—ë””í„°</button>
                            </div>
                            <textarea id="explanation" name="explanation" required placeholder="ë¬¸ì œ í•´ì„¤ì„ ì…ë ¥í•˜ì„¸ìš”. ì½”ë“œê°€ í¬í•¨ëœ ê²½ìš° ì½”ë“œ ì—ë””í„°ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”."></textarea>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="difficulty">ë‚œì´ë„</label>
                        <select id="difficulty" name="difficulty" required>
                            <option value="easy">ì‰¬ì›€</option>
                            <option value="medium">ë³´í†µ</option>
                            <option value="hard">ì–´ë ¤ì›€</option>
                        </select>
                    </div>
                    <button type="submit" class="btn-primary">ë¬¸ì œ ì¶”ê°€</button>
                </form>
            </div>
        </div>

        <!-- ë¬¸ì œ ê´€ë¦¬ íƒ­ -->
        <div id="manage-problems" class="tab-content">
            <div class="problem-form" style="margin-bottom: 20px;">
                <h3>ë¬¸ì œ ê²€ìƒ‰</h3>
                <div class="form-group">
                    <label for="problemSearch">ë¬¸ì œ ê²€ìƒ‰ (ë¬¸ì œ ë‚´ìš©, ê³¼ëª©ëª…, ID, ê³¼ëª©ë³„ë¬¸ì œë²ˆí˜¸ë¡œ ê²€ìƒ‰)</label>
                    <input type="text" id="problemSearch" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”... (ì˜ˆ: HTML 4, ID:826)" style="width: 100%; padding: 10px;">
                </div>
                <div class="form-group">
                    <label for="subjectFilter">ê³¼ëª© í•„í„°</label>
                    <select id="subjectFilter" style="width: 200px; padding: 10px;">
                        <option value="">ëª¨ë“  ê³¼ëª©</option>
                    </select>
                    <label for="difficultyFilter" style="margin-left: 20px;">ë‚œì´ë„ í•„í„°</label>
                    <select id="difficultyFilter" style="width: 150px; padding: 10px;">
                        <option value="">ëª¨ë“  ë‚œì´ë„</option>
                        <option value="easy">ì‰¬ì›€</option>
                        <option value="medium">ë³´í†µ</option>
                        <option value="hard">ì–´ë ¤ì›€</option>
                    </select>
                    <button type="button" class="btn-primary" onclick="searchProblems()" style="margin-left: 20px;">ê²€ìƒ‰</button>
                    <button type="button" class="btn-secondary" onclick="clearSearch()" style="margin-left: 10px;">ì´ˆê¸°í™”</button>
                </div>
                <div class="form-group">
                    <label for="pageSize">í˜ì´ì§€ë‹¹ í‘œì‹œ ê°œìˆ˜:</label>
                    <select id="pageSize" onchange="changePageSize()" style="width: 120px; padding: 8px; margin-left: 10px;">
                        <option value="20">20ê°œ</option>
                        <option value="50" selected>50ê°œ</option>
                        <option value="100">100ê°œ</option>
                        <option value="200">200ê°œ</option>
                    </select>
                </div>
            </div>
            
            <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
            <div id="pagination" style="text-align: center; margin: 20px 0; display: none;">
                <button id="prevPage" class="btn-secondary" onclick="goToPage(currentPage - 1)" style="margin: 0 5px;">&lt; ì´ì „</button>
                <span id="pageInfo" style="margin: 0 20px; font-weight: bold;"></span>
                <button id="nextPage" class="btn-secondary" onclick="goToPage(currentPage + 1)" style="margin: 0 5px;">ë‹¤ìŒ &gt;</button>
                <div style="margin-top: 10px;">
                    <input type="number" id="gotoPage" placeholder="í˜ì´ì§€ ë²ˆí˜¸" style="width: 100px; padding: 5px; margin: 0 10px;" min="1">
                    <button class="btn-secondary" onclick="goToPageInput()" style="padding: 5px 15px;">ì´ë™</button>
                </div>
            </div>
            
            <div class="problems-list" id="problemsList">
                <!-- ë¬¸ì œ ëª©ë¡ì´ ì—¬ê¸°ì— ë¡œë“œë©ë‹ˆë‹¤ -->
            </div>
        </div>

        <!-- ê³¼ëª© ê´€ë¦¬ íƒ­ -->
        <div id="manage-subjects" class="tab-content">
            <div class="problem-form">
                <h3>ìƒˆ ê³¼ëª© ì¶”ê°€</h3>
                <form id="addSubjectForm">
                    <div class="form-group">
                        <label for="subject-name">ê³¼ëª©ëª…</label>
                        <input type="text" id="subject-name" name="subject-name" required placeholder="ê³¼ëª©ëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    <div class="form-group">
                        <label for="subject-description">ê³¼ëª© ì„¤ëª…</label>
                        <textarea id="subject-description" name="subject-description" placeholder="ê³¼ëª©ì— ëŒ€í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="subject-category">ì¹´í…Œê³ ë¦¬</label>
                        <input type="text" id="subject-category" name="subject-category" placeholder="ì˜ˆ: Frontend, Backend, Database" required>
                    </div>
                    <div class="form-group">
                        <label for="subject-public">
                            <input type="checkbox" id="subject-public" name="subject-public" style="width: auto; margin-right: 10px;">
                            ê³µê°œ ì„¤ì • (ì²´í¬í•˜ë©´ ì‚¬ìš©ìë“¤ì´ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤)
                        </label>
                    </div>
                    <button type="submit" class="btn-primary">ê³¼ëª© ì¶”ê°€</button>
                </form>
            </div>
            
            <div class="problem-form">
                <h3>ê³¼ëª© ìˆœì„œ ê´€ë¦¬</h3>
                <p>ë“œë˜ê·¸í•˜ì—¬ ê³¼ëª© ìˆœì„œë¥¼ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë³€ê²½ í›„ "ìˆœì„œ ì €ì¥" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.</p>
                <div class="subjects-order-list" id="subjectsOrderList">
                    <!-- ê³¼ëª© ìˆœì„œ ëª©ë¡ì´ ì—¬ê¸°ì— ë¡œë“œë©ë‹ˆë‹¤ -->
                </div>
                <button type="button" class="btn-primary" onclick="saveSubjectsOrder()" style="margin-top: 15px;">ìˆœì„œ ì €ì¥</button>
            </div>
            
            <div class="problems-list" id="subjectsList">
                <!-- ê³¼ëª© ëª©ë¡ì´ ì—¬ê¸°ì— ë¡œë“œë©ë‹ˆë‹¤ -->
            </div>
        </div>

        <!-- ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ íƒ­ -->
        <div id="change-password" class="tab-content">
            <div class="problem-form">
                <h3>ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</h3>
                <form id="changePasswordForm">
                    <div class="form-group">
                        <label for="current-password">í˜„ì¬ ë¹„ë°€ë²ˆí˜¸</label>
                        <input type="password" id="current-password" name="current-password" required>
                    </div>
                    <div class="form-group">
                        <label for="new-password">ìƒˆ ë¹„ë°€ë²ˆí˜¸</label>
                        <input type="password" id="new-password" name="new-password" required>
                    </div>
                    <div class="form-group">
                        <label for="confirm-password">ìƒˆ ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
                        <input type="password" id="confirm-password" name="confirm-password" required>
                    </div>
                    <button type="submit" class="btn-primary">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</button>
                </form>
            </div>
        </div>
    </main>

    <!-- ê³¼ëª© ìˆ˜ì • ëª¨ë‹¬ -->
    <div id="editSubjectModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ê³¼ëª© ìˆ˜ì •</h3>
                <span class="close" onclick="closeEditSubjectModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="editSubjectForm">
                    <input type="hidden" id="edit-subject-id" name="subject-id">
                    <div class="form-group">
                        <label for="edit-subject-name">ê³¼ëª©ëª…</label>
                        <input type="text" id="edit-subject-name" name="subject-name" required placeholder="ê³¼ëª©ëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    <div class="form-group">
                        <label for="edit-subject-description">ê³¼ëª© ì„¤ëª…</label>
                        <textarea id="edit-subject-description" name="subject-description" placeholder="ê³¼ëª©ì— ëŒ€í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="edit-subject-category">ì¹´í…Œê³ ë¦¬</label>
                        <input type="text" id="edit-subject-category" name="subject-category" placeholder="ì˜ˆ: Frontend, Backend, Database" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-subject-public">
                            <input type="checkbox" id="edit-subject-public" name="subject-public" style="width: auto; margin-right: 10px;">
                            ê³µê°œ ì„¤ì • (ì²´í¬í•˜ë©´ ì‚¬ìš©ìë“¤ì´ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤)
                        </label>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn-primary">ìˆ˜ì • ì™„ë£Œ</button>
                        <button type="button" class="btn-secondary" onclick="closeEditSubjectModal()">ì·¨ì†Œ</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- ë¬¸ì œ ìˆ˜ì • ëª¨ë‹¬ -->
    <div id="editProblemModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ë¬¸ì œ ìˆ˜ì •</h3>
                <span class="close" onclick="closeEditModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="editProblemForm">
                    <input type="hidden" id="edit-problem-id" name="problem-id">
                    <div class="form-group">
                        <label for="edit-subject">ê³¼ëª© ì„ íƒ</label>
                        <select id="edit-subject" name="subject" required onchange="updateEditCodeMode()">
                            <option value="">ê³¼ëª©ì„ ì„ íƒí•˜ì„¸ìš”</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="edit-question">ë¬¸ì œ</label>
                        <div class="code-editor-container">
                            <div class="code-editor-header">
                                <span>ë¬¸ì œ í…ìŠ¤íŠ¸</span>
                                <button type="button" onclick="toggleEditCodeEditor('question')" style="padding: 4px 8px; font-size: 12px; background: #00d4aa; color: white; border: none; border-radius: 3px; cursor: pointer;">ì½”ë“œ ì—ë””í„°</button>
                            </div>
                            <textarea id="edit-question" name="question" required placeholder="ë¬¸ì œë¥¼ ì…ë ¥í•˜ì„¸ìš”. ì½”ë“œê°€ í¬í•¨ëœ ê²½ìš° ì½”ë“œ ì—ë””í„°ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”."></textarea>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="edit-option_a">1ë²ˆ</label>
                        <div class="code-editor-container">
                            <div class="code-editor-header">
                                <span>1ë²ˆ í…ìŠ¤íŠ¸</span>
                                <button type="button" onclick="toggleEditCodeEditor('option_a')" style="padding: 4px 8px; font-size: 12px; background: #00d4aa; color: white; border: none; border-radius: 3px; cursor: pointer;">ì½”ë“œ ì—ë””í„°</button>
                            </div>
                            <textarea id="edit-option_a" name="option_a" required placeholder="1ë²ˆì„ ì…ë ¥í•˜ì„¸ìš”. ì½”ë“œê°€ í¬í•¨ëœ ê²½ìš° ì½”ë“œ ì—ë””í„°ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”."></textarea>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="edit-option_b">2ë²ˆ</label>
                        <div class="code-editor-container">
                            <div class="code-editor-header">
                                <span>2ë²ˆ í…ìŠ¤íŠ¸</span>
                                <button type="button" onclick="toggleEditCodeEditor('option_b')" style="padding: 4px 8px; font-size: 12px; background: #00d4aa; color: white; border: none; border-radius: 3px; cursor: pointer;">ì½”ë“œ ì—ë””í„°</button>
                            </div>
                            <textarea id="edit-option_b" name="option_b" required placeholder="2ë²ˆì„ ì…ë ¥í•˜ì„¸ìš”. ì½”ë“œê°€ í¬í•¨ëœ ê²½ìš° ì½”ë“œ ì—ë””í„°ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”."></textarea>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="edit-option_c">3ë²ˆ</label>
                        <div class="code-editor-container">
                            <div class="code-editor-header">
                                <span>3ë²ˆ í…ìŠ¤íŠ¸</span>
                                <button type="button" onclick="toggleEditCodeEditor('option_c')" style="padding: 4px 8px; font-size: 12px; background: #00d4aa; color: white; border: none; border-radius: 3px; cursor: pointer;">ì½”ë“œ ì—ë””í„°</button>
                            </div>
                            <textarea id="edit-option_c" name="option_c" required placeholder="3ë²ˆì„ ì…ë ¥í•˜ì„¸ìš”. ì½”ë“œê°€ í¬í•¨ëœ ê²½ìš° ì½”ë“œ ì—ë””í„°ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”."></textarea>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="edit-option_d">4ë²ˆ</label>
                        <div class="code-editor-container">
                            <div class="code-editor-header">
                                <span>4ë²ˆ í…ìŠ¤íŠ¸</span>
                                <button type="button" onclick="toggleEditCodeEditor('option_d')" style="padding: 4px 8px; font-size: 12px; background: #00d4aa; color: white; border: none; border-radius: 3px; cursor: pointer;">ì½”ë“œ ì—ë””í„°</button>
                            </div>
                            <textarea id="edit-option_d" name="option_d" required placeholder="4ë²ˆì„ ì…ë ¥í•˜ì„¸ìš”. ì½”ë“œê°€ í¬í•¨ëœ ê²½ìš° ì½”ë“œ ì—ë””í„°ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”."></textarea>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="edit-correct_answer">ì •ë‹µ</label>
                        <select id="edit-correct_answer" name="correct_answer" required>
                            <option value="">ì •ë‹µì„ ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="edit-explanation">í•´ì„¤</label>
                        <div class="code-editor-container">
                            <div class="code-editor-header">
                                <span>í•´ì„¤ í…ìŠ¤íŠ¸</span>
                                <button type="button" onclick="toggleEditCodeEditor('explanation')" style="padding: 4px 8px; font-size: 12px; background: #00d4aa; color: white; border: none; border-radius: 3px; cursor: pointer;">ì½”ë“œ ì—ë””í„°</button>
                            </div>
                            <textarea id="edit-explanation" name="explanation" required placeholder="ë¬¸ì œ í•´ì„¤ì„ ì…ë ¥í•˜ì„¸ìš”. ì½”ë“œê°€ í¬í•¨ëœ ê²½ìš° ì½”ë“œ ì—ë””í„°ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”."></textarea>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="edit-difficulty">ë‚œì´ë„</label>
                        <select id="edit-difficulty" name="difficulty" required>
                            <option value="easy">ì‰¬ì›€</option>
                            <option value="medium">ë³´í†µ</option>
                            <option value="hard">ì–´ë ¤ì›€</option>
                        </select>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn-primary">ìˆ˜ì • ì™„ë£Œ</button>
                        <button type="button" class="btn-secondary" onclick="closeEditModal()">ì·¨ì†Œ</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // ê´€ë¦¬ì ê¶Œí•œ í™•ì¸
        async function checkAdminAuth() {
            try {
                const response = await fetch('/api/auth/check');
                const data = await response.json();
                
                if (!data.isLoggedIn || !data.isAdmin) {
                    alert('ê´€ë¦¬ì ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.');
                    window.location.href = '/';
                }
            } catch (error) {
                console.error('ê¶Œí•œ í™•ì¸ ì˜¤ë¥˜:', error);
                window.location.href = '/';
            }
        }

        // íƒ­ ì „í™˜
        function showTab(tabName) {
            // ëª¨ë“  íƒ­ê³¼ ì½˜í…ì¸  ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.admin-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // ì„ íƒëœ íƒ­ê³¼ ì½˜í…ì¸  ë³´ì´ê¸°
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            // íƒ­ë³„ ë°ì´í„° ë¡œë“œ
            if (tabName === 'dashboard') {
                loadDashboardStats();
            } else if (tabName === 'manage-problems') {
                loadProblems();
            } else if (tabName === 'manage-subjects') {
                loadSubjectsList();
            }
        }

        // ëŒ€ì‹œë³´ë“œ í†µê³„ ë¡œë“œ
        async function loadDashboardStats() {
            try {
                const response = await fetch('/api/admin/stats');
                const data = await response.json();
                
                if (data.success) {
                    const statsGrid = document.getElementById('statsGrid');
                    statsGrid.innerHTML = `
                        <div class="stat-card">
                            <div class="stat-number">${data.stats.totalProblems}</div>
                            <div class="stat-label">ì´ ë¬¸ì œ ìˆ˜</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${data.stats.totalSubjects}</div>
                            <div class="stat-label">ì´ ê³¼ëª© ìˆ˜</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${data.stats.totalUsers}</div>
                            <div class="stat-label">ì´ ì‚¬ìš©ì ìˆ˜</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${data.stats.totalAttempts}</div>
                            <div class="stat-label">ì´ í’€ì´ ì‹œë„</div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('í†µê³„ ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }

        // ê³¼ëª© ëª©ë¡ ë¡œë“œ (ë¬¸ì œ ì¶”ê°€ í¼ìš© - ëª¨ë“  ê³¼ëª©)
        async function loadSubjects() {
            try {
                const response = await fetch('/api/admin/subjects');
                const data = await response.json();
                
                if (data.success) {
                    const subjectSelect = document.getElementById('subject');
                    subjectSelect.innerHTML = '<option value="">ê³¼ëª©ì„ ì„ íƒí•˜ì„¸ìš”</option>';
                    
                    data.subjects.forEach(subject => {
                        const option = document.createElement('option');
                        option.value = subject.id;
                        option.textContent = `${subject.name} ${subject.is_public ? '(ê³µê°œ)' : '(ë¹„ê³µê°œ)'}`;
                        subjectSelect.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('ê³¼ëª© ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }

        // ë¬¸ì œ ì¶”ê°€
        async function addProblem(formData) {
            try {
                // í¼ ìœ íš¨ì„± ê²€ì‚¬
                const form = document.getElementById('addProblemForm');
                if (!form.checkValidity()) {
                    // ìˆ¨ê²¨ì§„ í•„ë“œë“¤ì„ ì„ì‹œë¡œ í™œì„±í™”í•˜ì—¬ ìœ íš¨ì„± ê²€ì‚¬
                    const hiddenFields = form.querySelectorAll('input[disabled], textarea[disabled]');
                    hiddenFields.forEach(field => {
                        field.removeAttribute('disabled');
                        field.style.display = 'block';
                    });
                    
                    // ìœ íš¨ì„± ê²€ì‚¬ ì‹¤í–‰
                    form.reportValidity();
                    
                    // ë‹¤ì‹œ ìˆ¨ê¹€
                    hiddenFields.forEach(field => {
                        field.setAttribute('disabled', 'disabled');
                        field.style.display = 'none';
                    });
                    
                    return;
                }
                
                // FormDataë¥¼ ê°ì²´ë¡œ ë³€í™˜
                const problemData = {
                    subject_id: formData.get('subject_id'),
                    question: formData.get('question'),
                    option_a: formData.get('option_a'),
                    option_b: formData.get('option_b'),
                    option_c: formData.get('option_c'),
                    option_d: formData.get('option_d'),
                    correct_answer: formData.get('correct_answer'),
                    explanation: formData.get('explanation'),
                    difficulty: formData.get('difficulty')
                };
                
                // ë””ë²„ê¹…ì„ ìœ„í•œ ë¡œê·¸
                console.log('ì „ì†¡í•  ë°ì´í„°:', problemData);
                
                const response = await fetch('/api/admin/problems', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(problemData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showMessage('ë¬¸ì œê°€ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    document.getElementById('addProblemForm').reset();
                    
                    // ì½”ë“œ ì—ë””í„° ì´ˆê¸°í™”
                    if (questionEditor) {
                        questionEditor.setValue('');
                    }
                    if (explanationEditor) {
                        explanationEditor.setValue('');
                    }
                    Object.values(optionEditors).forEach(editor => {
                        if (editor) {
                            editor.setValue('');
                        }
                    });
                    
                    loadProblems(); // ë¬¸ì œ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                } else {
                    showMessage(data.message || 'ë¬¸ì œ ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            } catch (error) {
                console.error('ë¬¸ì œ ì¶”ê°€ ì˜¤ë¥˜:', error);
                showMessage('ë¬¸ì œ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ì „ì—­ ë³€ìˆ˜ë¡œ ëª¨ë“  ë¬¸ì œ ì €ì¥
        let allProblems = [];
        let filteredProblems = [];
        let currentPage = 1;
        let pageSize = 50;
        
        // HTML ì´ìŠ¤ì¼€ì´í”„ í•¨ìˆ˜
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // ë¬¸ì œ ëª©ë¡ ë¡œë“œ
        async function loadProblems() {
            try {
                console.log('ë¬¸ì œ ëª©ë¡ ë¡œë“œ ì‹œì‘...');
                const response = await fetch('/api/admin/problems');
                const data = await response.json();
                
                if (data.success) {
                    console.log(`ë¬¸ì œ ëª©ë¡ ë¡œë“œ ì„±ê³µ: ${data.problems.length}ê°œ`);
                    
                    // ì „ì—­ ë³€ìˆ˜ì— ëª¨ë“  ë¬¸ì œ ì €ì¥
                    allProblems = data.problems;
                    filteredProblems = data.problems;
                    
                    // í˜ì´ì§€ ìƒíƒœ ë³µì›ì´ í•„ìš”í•œ ê²½ìš°ê°€ ì•„ë‹ˆë©´ ì²« í˜ì´ì§€ë¡œ
                    if (!window.currentEditPage) {
                        currentPage = 1;
                    }
                    
                    // ê²€ìƒ‰ í•„í„°ì˜ ê³¼ëª© ì˜µì…˜ ì—…ë°ì´íŠ¸
                    loadSubjectFilter();
                    
                    // í˜ì´ì§€ë„¤ì´ì…˜ê³¼ í•¨ê»˜ ë¬¸ì œ í‘œì‹œ
                    displayProblemsWithPagination();
                    
                    console.log('âœ… ë¬¸ì œ ëª©ë¡ ë Œë”ë§ ì™„ë£Œ');
                } else {
                    console.error('âŒ API ì‘ë‹µ ì‹¤íŒ¨:', data.message);
                    showMessage(data.message || 'ë¬¸ì œ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                }
            } catch (error) {
                console.error('âŒ ë¬¸ì œ ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
                showMessage('ë¬¸ì œ ëª©ë¡ ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }
        
        // í˜ì´ì§€ë„¤ì´ì…˜ê³¼ í•¨ê»˜ ë¬¸ì œ í‘œì‹œ
        function displayProblemsWithPagination() {
            console.log('ğŸ“Š displayProblemsWithPagination í•¨ìˆ˜ ì‹œì‘');
            console.log('ğŸ“Š filteredProblems.length:', filteredProblems.length);
            console.log('ğŸ“Š pageSize:', pageSize);
            console.log('ğŸ“Š currentPage:', currentPage);
            
            const totalProblems = filteredProblems.length;
            const totalPages = Math.ceil(totalProblems / pageSize);
            
            // í˜„ì¬ í˜ì´ì§€ ë²”ìœ„ ê³„ì‚°
            const startIndex = (currentPage - 1) * pageSize;
            const endIndex = Math.min(startIndex + pageSize, totalProblems);
            const currentPageProblems = filteredProblems.slice(startIndex, endIndex);
            
            console.log('totalPages:', totalPages);
            console.log('startIndex:', startIndex);
            console.log('endIndex:', endIndex);
            console.log('currentPageProblems.length:', currentPageProblems.length);
            
            // í—¤ë” í…ìŠ¤íŠ¸ ìƒì„±
            const headerText = `í˜ì´ì§€ ${currentPage}/${totalPages} (${startIndex + 1}-${endIndex}ë²ˆì§¸ ë¬¸ì œ, ì´ ${totalProblems}ê°œ)`;
            
            // ë¬¸ì œ í‘œì‹œ
            displayProblems(currentPageProblems, headerText);
            
            // í˜ì´ì§€ë„¤ì´ì…˜ UI ì—…ë°ì´íŠ¸
            updatePagination(totalPages);
            
            console.log('displayProblemsWithPagination í•¨ìˆ˜ ì™„ë£Œ');
        }
        
        // ë¬¸ì œ í‘œì‹œ í•¨ìˆ˜
        function displayProblems(problems, headerText) {
            console.log('displayProblems í•¨ìˆ˜ ì‹œì‘');
            console.log('problems.length:', problems.length);
            console.log('headerText:', headerText);
            
            const problemsList = document.getElementById('problemsList');
            console.log('problemsList ì—˜ë¦¬ë¨¼íŠ¸:', problemsList);
            
            if (!problemsList) {
                console.error('problemsList ì—˜ë¦¬ë¨¼íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
                return;
            }
            
            // í—¤ë” ì •ë³´ ì¶”ê°€
            let headerHTML = `
                <div class="problem-item" style="background: #f8f9fa; border-bottom: 2px solid #00d4aa;">
                    <div class="problem-info">
                        <h4>${headerText}</h4>
                        <p>ê²€ìƒ‰ ë° í•„í„° ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì—¬ íŠ¹ì • ë¬¸ì œë¥¼ ì°¾ì•„ë³´ì„¸ìš”</p>
                    </div>
                </div>
            `;
            
            console.log('ë¬¸ì œ HTML ìƒì„± ì‹œì‘...');
            const problemsHTML = problems.map((problem, index) => {
                try {
                    if (index < 3) { // ì²˜ìŒ 3ê°œë§Œ ë¡œê·¸
                        console.log(`ë¬¸ì œ ${index + 1}:`, problem.id, problem.question ? problem.question.substring(0, 50) : 'No question');
                    }
                    
                    // ì•ˆì „í•œ ë°ì´í„° ì²˜ë¦¬
                    const safeId = problem.id || 'unknown';
                    const safeSubjectName = problem.subject_name || 'ì•Œ ìˆ˜ ì—†ìŒ';
                    const safeDifficulty = problem.difficulty || 'ë³´í†µ';
                    const safeCreatedAt = problem.created_at ? new Date(problem.created_at).toLocaleDateString() : 'ë‚ ì§œ ì—†ìŒ';
                    
                    // ì •ë‹µì„ 1, 2, 3, 4ë¡œ ë³€í™˜
                    const answerMap = { 'A': '1', 'B': '2', 'C': '3', 'D': '4' };
                    const displayCorrectAnswer = answerMap[problem.correct_answer] || problem.correct_answer || '?';
                    
                    // ë¬¸ì œ ì œëª©ì„ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬ - HTML ì´ìŠ¤ì¼€ì´í”„
                    const questionPreview = problem.question 
                        ? escapeHtml(problem.question.replace(/\n/g, ' ').substring(0, 80)) + (problem.question.length > 80 ? '...' : '')
                        : 'ë¬¸ì œ ë‚´ìš© ì—†ìŒ';
                    
                    // ê³¼ëª©ë³„ ë¬¸ì œë²ˆí˜¸ í‘œì‹œ
                    const subjectProblemNumber = problem.subject_problem_number || '?';
                    
                    return `
                        <div class="problem-item">
                            <div class="problem-info">
                                <h4>${escapeHtml(safeSubjectName)} ${subjectProblemNumber}ë²ˆ (ID: ${safeId}) - ${questionPreview}</h4>
                                <p>ê³¼ëª©: ${escapeHtml(safeSubjectName)} | ê³¼ëª©ë‚´ë²ˆí˜¸: ${subjectProblemNumber} | ë‚œì´ë„: ${safeDifficulty} | ì •ë‹µ: ${displayCorrectAnswer} | ìƒì„±: ${safeCreatedAt}</p>
                            </div>
                            <div class="problem-actions">
                                <button class="btn-primary" onclick="editProblem(${safeId})">ìˆ˜ì •</button>
                                <button class="btn-danger" onclick="deleteProblem(${safeId})">ì‚­ì œ</button>
                            </div>
                        </div>
                    `;
                } catch (error) {
                    console.error(`ë¬¸ì œ ${index + 1} HTML ìƒì„± ì˜¤ë¥˜:`, error, problem);
                    return `
                        <div class="problem-item" style="background-color: #ffe6e6;">
                            <div class="problem-info">
                                <h4>ì˜¤ë¥˜ - ID: ${problem.id || 'unknown'}</h4>
                                <p>ì´ ë¬¸ì œë¥¼ í‘œì‹œí•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>
                            </div>
                            <div class="problem-actions">
                                <button class="btn-danger" onclick="deleteProblem(${problem.id || 0})">ì‚­ì œ</button>
                            </div>
                        </div>
                    `;
                }
            }).join('');
            
            console.log('HTML ìƒì„± ì™„ë£Œ, DOMì— ì ìš© ì¤‘...');
            problemsList.innerHTML = headerHTML + problemsHTML;
            console.log('DOM ì—…ë°ì´íŠ¸ ì™„ë£Œ');
            console.log('ìµœì¢… problemsList.innerHTML ê¸¸ì´:', problemsList.innerHTML.length);
            
            // DOMì´ ì‹¤ì œë¡œ ì—…ë°ì´íŠ¸ë˜ì—ˆëŠ”ì§€ í™•ì¸
            setTimeout(() => {
                const items = problemsList.querySelectorAll('.problem-item');
                console.log('ì‹¤ì œ DOMì— ë Œë”ë§ëœ problem-item ê°œìˆ˜:', items.length);
            }, 100);
        }
        
        // í˜ì´ì§€ë„¤ì´ì…˜ UI ì—…ë°ì´íŠ¸
        function updatePagination(totalPages) {
            console.log('í˜ì´ì§€ë„¤ì´ì…˜ ì—…ë°ì´íŠ¸ ì‹œì‘, totalPages:', totalPages);
            
            const pagination = document.getElementById('pagination');
            const pageInfo = document.getElementById('pageInfo');
            const prevButton = document.getElementById('prevPage');
            const nextButton = document.getElementById('nextPage');
            const gotoPageInput = document.getElementById('gotoPage');
            
            console.log('í˜ì´ì§€ë„¤ì´ì…˜ ì—˜ë¦¬ë¨¼íŠ¸ë“¤:', {
                pagination: !!pagination,
                pageInfo: !!pageInfo,
                prevButton: !!prevButton,
                nextButton: !!nextButton,
                gotoPageInput: !!gotoPageInput
            });
            
            if (totalPages <= 1) {
                console.log('totalPages <= 1, í˜ì´ì§€ë„¤ì´ì…˜ ìˆ¨ê¹€');
                if (pagination) pagination.style.display = 'none';
                return;
            }
            
            if (pagination) {
                pagination.style.display = 'block';
                console.log('í˜ì´ì§€ë„¤ì´ì…˜ í‘œì‹œë¨');
            }
            
            if (pageInfo) {
                pageInfo.textContent = `${currentPage} / ${totalPages} í˜ì´ì§€`;
                console.log('í˜ì´ì§€ ì •ë³´ ì—…ë°ì´íŠ¸:', pageInfo.textContent);
            }
            
            // ì´ì „/ë‹¤ìŒ ë²„íŠ¼ í™œì„±í™”/ë¹„í™œì„±í™”
            if (prevButton) {
                prevButton.disabled = currentPage <= 1;
                console.log('ì´ì „ ë²„íŠ¼ ìƒíƒœ:', prevButton.disabled ? 'disabled' : 'enabled');
            }
            if (nextButton) {
                nextButton.disabled = currentPage >= totalPages;
                console.log('ë‹¤ìŒ ë²„íŠ¼ ìƒíƒœ:', nextButton.disabled ? 'disabled' : 'enabled');
            }
            
            // í˜ì´ì§€ ì´ë™ input ì„¤ì •
            if (gotoPageInput) {
                gotoPageInput.max = totalPages;
                gotoPageInput.value = '';
                console.log('í˜ì´ì§€ ì´ë™ input ì„¤ì • ì™„ë£Œ, max:', totalPages);
            }
        }
        
        // í˜ì´ì§€ ì´ë™
        function goToPage(page) {
            const totalPages = Math.ceil(filteredProblems.length / pageSize);
            
            if (page < 1 || page > totalPages) {
                return;
            }
            
            currentPage = page;
            displayProblemsWithPagination();
            
            // ìŠ¤í¬ë¡¤ì„ ë§¨ ìœ„ë¡œ
            document.getElementById('problemsList').scrollIntoView({ behavior: 'smooth' });
        }
        
        // í˜ì´ì§€ ë²ˆí˜¸ ì…ë ¥ìœ¼ë¡œ ì´ë™
        function goToPageInput() {
            const pageInput = document.getElementById('gotoPage');
            const page = parseInt(pageInput.value);
            
            if (isNaN(page)) {
                alert('ì˜¬ë°”ë¥¸ í˜ì´ì§€ ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            goToPage(page);
        }
        
        // í˜ì´ì§€ í¬ê¸° ë³€ê²½
        function changePageSize() {
            const pageSizeSelect = document.getElementById('pageSize');
            pageSize = parseInt(pageSizeSelect.value);
            currentPage = 1; // ì²« í˜ì´ì§€ë¡œ ë¦¬ì…‹
            displayProblemsWithPagination();
        }
        
        // ê²€ìƒ‰ í•„í„°ì˜ ê³¼ëª© ì˜µì…˜ ë¡œë“œ
        function loadSubjectFilter() {
            const subjectFilter = document.getElementById('subjectFilter');
            if (!subjectFilter) return;
            
            const subjects = [...new Set(allProblems.map(p => p.subject_name))];
            subjectFilter.innerHTML = '<option value="">ëª¨ë“  ê³¼ëª©</option>';
            
            subjects.forEach(subject => {
                const option = document.createElement('option');
                option.value = subject;
                option.textContent = subject;
                subjectFilter.appendChild(option);
            });
        }
        
        // ë¬¸ì œ ê²€ìƒ‰ í•¨ìˆ˜
        function searchProblems() {
            const searchTerm = document.getElementById('problemSearch').value.toLowerCase();
            const subjectFilter = document.getElementById('subjectFilter').value;
            const difficultyFilter = document.getElementById('difficultyFilter').value;
            
            filteredProblems = allProblems;
            
            // í…ìŠ¤íŠ¸ ê²€ìƒ‰ (ë¬¸ì œ ë‚´ìš©, ê³¼ëª©ëª…, ID, ê³¼ëª©ë³„ ë¬¸ì œë²ˆí˜¸)
            if (searchTerm) {
                filteredProblems = filteredProblems.filter(problem => 
                    problem.question.toLowerCase().includes(searchTerm) ||
                    problem.subject_name.toLowerCase().includes(searchTerm) ||
                    problem.id.toString().includes(searchTerm) ||
                    (problem.subject_problem_number && problem.subject_problem_number.toString().includes(searchTerm)) ||
                    problem.option_a.toLowerCase().includes(searchTerm) ||
                    problem.option_b.toLowerCase().includes(searchTerm) ||
                    problem.option_c.toLowerCase().includes(searchTerm) ||
                    problem.option_d.toLowerCase().includes(searchTerm) ||
                    problem.explanation.toLowerCase().includes(searchTerm)
                );
            }
            
            // ê³¼ëª© í•„í„°
            if (subjectFilter) {
                filteredProblems = filteredProblems.filter(problem => 
                    problem.subject_name === subjectFilter
                );
            }
            
            // ë‚œì´ë„ í•„í„°
            if (difficultyFilter) {
                filteredProblems = filteredProblems.filter(problem => 
                    problem.difficulty === difficultyFilter
                );
            }
            
            // í˜ì´ì§€ ìƒíƒœ ë³µì›ì´ í•„ìš”í•œ ê²½ìš°ê°€ ì•„ë‹ˆë©´ ì²« í˜ì´ì§€ë¡œ ì´ë™
            if (!window.currentEditPage) {
                currentPage = 1;
            }
            displayProblemsWithPagination();
        }
        
        // ê²€ìƒ‰ ì´ˆê¸°í™”
        function clearSearch() {
            document.getElementById('problemSearch').value = '';
            document.getElementById('subjectFilter').value = '';
            document.getElementById('difficultyFilter').value = '';
            
            // ì „ì²´ ë¬¸ì œë¡œ ë¦¬ì…‹
            filteredProblems = allProblems;
            currentPage = 1;
            displayProblemsWithPagination();
        }

        // ë¬¸ì œ ìˆ˜ì • ëª¨ë‹¬ ì—´ê¸°
        async function editProblem(problemId) {
            console.log('ğŸš€ editProblem í•¨ìˆ˜ í˜¸ì¶œë¨ - problemId:', problemId);
            try {
                // í˜„ì¬ í˜ì´ì§€ ìƒíƒœ ì €ì¥
                window.currentEditPage = currentPage;
                window.currentEditPageSize = pageSize;
                window.currentEditSearchTerm = document.getElementById('problemSearch').value;
                window.currentEditSubjectFilter = document.getElementById('subjectFilter').value;
                window.currentEditDifficultyFilter = document.getElementById('difficultyFilter').value;
                
                console.log('ğŸ” ë¬¸ì œ ìˆ˜ì • ëª¨ë‹¬ ì—´ê¸° - ì €ì¥ëœ ìƒíƒœ:', {
                    currentPage: window.currentEditPage,
                    pageSize: window.currentEditPageSize,
                    searchTerm: window.currentEditSearchTerm,
                    subjectFilter: window.currentEditSubjectFilter,
                    difficultyFilter: window.currentEditDifficultyFilter
                });
                
                // ë¬¸ì œ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                const response = await fetch(`/api/admin/problems/${problemId}`);
                const data = await response.json();
                
                if (!data.success) {
                    showMessage('ë¬¸ì œ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                    return;
                }
                
                const problem = data.problem;
                
                // ìˆ˜ì • ëª¨ë‹¬ì˜ ê³¼ëª© ì„ íƒ ì˜µì…˜ ë¡œë“œ
                await loadEditSubjects();
                
                // ì •ë‹µì„ 1, 2, 3, 4ë¡œ ë³€í™˜
                const answerMap = { 'A': '1', 'B': '2', 'C': '3', 'D': '4' };
                const displayCorrectAnswer = answerMap[problem.correct_answer] || problem.correct_answer;
                
                // ëª¨ë‹¬ í•„ë“œì— ë°ì´í„° ì„¤ì •
                document.getElementById('edit-problem-id').value = problem.id;
                document.getElementById('edit-subject').value = problem.subject_id;
                document.getElementById('edit-question').value = problem.question;
                document.getElementById('edit-option_a').value = problem.option_a;
                document.getElementById('edit-option_b').value = problem.option_b;
                document.getElementById('edit-option_c').value = problem.option_c;
                document.getElementById('edit-option_d').value = problem.option_d;
                document.getElementById('edit-correct_answer').value = displayCorrectAnswer;
                document.getElementById('edit-explanation').value = problem.explanation;
                document.getElementById('edit-difficulty').value = problem.difficulty;
                
                // ëª¨ë‹¬ ì—´ê¸°
                document.getElementById('editProblemModal').style.display = 'block';
                
            } catch (error) {
                console.error('ë¬¸ì œ ì •ë³´ ë¡œë“œ ì˜¤ë¥˜:', error);
                showMessage('ë¬¸ì œ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }
        
        // ìˆ˜ì • ëª¨ë‹¬ìš© ê³¼ëª© ëª©ë¡ ë¡œë“œ (ëª¨ë“  ê³¼ëª©)
        async function loadEditSubjects() {
            try {
                const response = await fetch('/api/admin/subjects');
                const data = await response.json();
                
                if (data.success) {
                    const subjectSelect = document.getElementById('edit-subject');
                    subjectSelect.innerHTML = '<option value="">ê³¼ëª©ì„ ì„ íƒí•˜ì„¸ìš”</option>';
                    
                    data.subjects.forEach(subject => {
                        const option = document.createElement('option');
                        option.value = subject.id;
                        option.textContent = `${subject.name} ${subject.is_public ? '(ê³µê°œ)' : '(ë¹„ê³µê°œ)'}`;
                        subjectSelect.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('ìˆ˜ì • ëª¨ë‹¬ ê³¼ëª© ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }
        
        // ë¬¸ì œ ìˆ˜ì • ëª¨ë‹¬ ë‹«ê¸°
        function closeEditModal() {
            document.getElementById('editProblemModal').style.display = 'none';
            
            // ìˆ˜ì • ëª¨ë‹¬ ì—ë””í„°ë“¤ ì •ë¦¬
            if (editQuestionEditor) {
                editQuestionEditor.toTextArea();
                editQuestionEditor = null;
            }
            if (editExplanationEditor) {
                editExplanationEditor.toTextArea();
                editExplanationEditor = null;
            }
            Object.values(editOptionEditors).forEach(editor => {
                if (editor) {
                    editor.toTextArea();
                }
            });
            editOptionEditors = {};
        }
        
        // ë¬¸ì œ ìˆ˜ì • ì œì¶œ
        async function submitEditProblem(formData) {
            try {
                const problemId = document.getElementById('edit-problem-id').value;
                
                // FormDataë¥¼ ê°ì²´ë¡œ ë³€í™˜
                const problemData = {
                    subject_id: formData.get('subject'),
                    question: formData.get('question'),
                    option_a: formData.get('option_a'),
                    option_b: formData.get('option_b'),
                    option_c: formData.get('option_c'),
                    option_d: formData.get('option_d'),
                    correct_answer: formData.get('correct_answer'),
                    explanation: formData.get('explanation'),
                    difficulty: formData.get('difficulty')
                };
                
                const response = await fetch(`/api/admin/problems/${problemId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(problemData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showMessage('ë¬¸ì œê°€ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    closeEditModal();
                    
                    // ì €ì¥ëœ í˜ì´ì§€ ìƒíƒœ ë³µì›
                    if (window.currentEditPage) {
                        console.log('ğŸ”„ ë¬¸ì œ ìˆ˜ì • ì™„ë£Œ - ìƒíƒœ ë³µì› ì‹œì‘:', {
                            savedPage: window.currentEditPage,
                            savedPageSize: window.currentEditPageSize,
                            savedSearchTerm: window.currentEditSearchTerm,
                            savedSubjectFilter: window.currentEditSubjectFilter,
                            savedDifficultyFilter: window.currentEditDifficultyFilter
                        });
                        
                        // ê²€ìƒ‰ í•„í„° ë³µì›
                        if (window.currentEditSearchTerm !== undefined) {
                            document.getElementById('problemSearch').value = window.currentEditSearchTerm;
                        }
                        if (window.currentEditSubjectFilter !== undefined) {
                            document.getElementById('subjectFilter').value = window.currentEditSubjectFilter;
                        }
                        if (window.currentEditDifficultyFilter !== undefined) {
                            document.getElementById('difficultyFilter').value = window.currentEditDifficultyFilter;
                        }
                        
                        // í˜ì´ì§€ ìƒíƒœ ë³µì›
                        currentPage = window.currentEditPage;
                        pageSize = window.currentEditPageSize || 50;
                        
                        console.log('ğŸ“„ ë³µì›ëœ í˜ì´ì§€ ìƒíƒœ:', {
                            currentPage: currentPage,
                            pageSize: pageSize
                        });
                        
                        // í•„í„°ë§ëœ ë¬¸ì œ ëª©ë¡ ë‹¤ì‹œ ìƒì„± (í˜ì´ì§€ ë¦¬ì…‹ ì—†ì´)
                        const searchTerm = window.currentEditSearchTerm || '';
                        const subjectFilter = window.currentEditSubjectFilter || '';
                        const difficultyFilter = window.currentEditDifficultyFilter || '';
                        
                        filteredProblems = allProblems;
                        
                        // í…ìŠ¤íŠ¸ ê²€ìƒ‰
                        if (searchTerm) {
                            filteredProblems = filteredProblems.filter(problem => 
                                problem.question.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                problem.subject_name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                problem.id.toString().includes(searchTerm) ||
                                (problem.subject_problem_number && problem.subject_problem_number.toString().includes(searchTerm)) ||
                                problem.option_a.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                problem.option_b.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                problem.option_c.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                problem.option_d.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                problem.explanation.toLowerCase().includes(searchTerm.toLowerCase())
                            );
                        }
                        
                        // ê³¼ëª© í•„í„°
                        if (subjectFilter) {
                            filteredProblems = filteredProblems.filter(problem => 
                                problem.subject_name === subjectFilter
                            );
                        }
                        
                        // ë‚œì´ë„ í•„í„°
                        if (difficultyFilter) {
                            filteredProblems = filteredProblems.filter(problem => 
                                problem.difficulty === difficultyFilter
                            );
                        }
                        
                        console.log('ğŸ” í•„í„°ë§ ê²°ê³¼:', {
                            totalProblems: allProblems.length,
                            filteredProblems: filteredProblems.length,
                            searchTerm: searchTerm,
                            subjectFilter: subjectFilter,
                            difficultyFilter: difficultyFilter
                        });
                        
                        // í˜ì´ì§€ë„¤ì´ì…˜ê³¼ í•¨ê»˜ ë¬¸ì œ í‘œì‹œ
                        displayProblemsWithPagination();
                        
                        // ì €ì¥ëœ ìƒíƒœ ì´ˆê¸°í™”
                        delete window.currentEditPage;
                        delete window.currentEditPageSize;
                        delete window.currentEditSearchTerm;
                        delete window.currentEditSubjectFilter;
                        delete window.currentEditDifficultyFilter;
                    } else {
                        console.log('âš ï¸ ì €ì¥ëœ í˜ì´ì§€ ìƒíƒœê°€ ì—†ìŒ - loadProblems() í˜¸ì¶œ');
                        loadProblems(); // ë¬¸ì œ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                    }
                } else {
                    showMessage(data.message || 'ë¬¸ì œ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            } catch (error) {
                console.error('ë¬¸ì œ ìˆ˜ì • ì˜¤ë¥˜:', error);
                showMessage('ë¬¸ì œ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }
        
        // ìˆ˜ì • ëª¨ë‹¬ìš© ì½”ë“œ ì—ë””í„° í† ê¸€
        function toggleEditCodeEditor(field) {
            const container = document.getElementById(`edit-${field}`).parentElement;
            const textarea = document.getElementById(`edit-${field}`);
            const button = container.querySelector('button');
            
            if (textarea.style.display === 'none') {
                // í…ìŠ¤íŠ¸ ì—ë””í„°ë¡œ ì „í™˜
                textarea.style.display = 'block';
                textarea.removeAttribute('disabled');
                if (field === 'question' && editQuestionEditor) {
                    editQuestionEditor.toTextArea();
                    editQuestionEditor = null;
                } else if (field === 'explanation' && editExplanationEditor) {
                    editExplanationEditor.toTextArea();
                    editExplanationEditor = null;
                } else if (editOptionEditors[field]) {
                    editOptionEditors[field].toTextArea();
                    editOptionEditors[field] = null;
                }
                button.textContent = 'ì½”ë“œ ì—ë””í„°';
            } else {
                // ì½”ë“œ ì—ë””í„°ë¡œ ì „í™˜
                textarea.style.display = 'none';
                textarea.setAttribute('disabled', 'disabled');
                if (field === 'question') {
                    editQuestionEditor = CodeMirror.fromTextArea(textarea, {
                        mode: 'javascript',
                        theme: 'monokai',
                        lineNumbers: true,
                        autoCloseBrackets: true,
                        matchBrackets: true,
                        indentUnit: 4,
                        tabSize: 4,
                        lineWrapping: true
                    });
                } else if (field === 'explanation') {
                    editExplanationEditor = CodeMirror.fromTextArea(textarea, {
                        mode: 'javascript',
                        theme: 'monokai',
                        lineNumbers: true,
                        autoCloseBrackets: true,
                        matchBrackets: true,
                        indentUnit: 4,
                        tabSize: 4,
                        lineWrapping: true
                    });
                } else if (['option_a', 'option_b', 'option_c', 'option_d'].includes(field)) {
                    editOptionEditors[field] = CodeMirror.fromTextArea(textarea, {
                        mode: 'javascript',
                        theme: 'monokai',
                        lineNumbers: true,
                        autoCloseBrackets: true,
                        matchBrackets: true,
                        indentUnit: 4,
                        tabSize: 4,
                        lineWrapping: true
                    });
                }
                button.textContent = 'í…ìŠ¤íŠ¸ ì—ë””í„°';
            }
        }
        
        // ìˆ˜ì • ëª¨ë‹¬ìš© ê³¼ëª©ì— ë”°ë¥¸ ì½”ë“œ ëª¨ë“œ ì—…ë°ì´íŠ¸
        function updateEditCodeMode() {
            const subjectSelect = document.getElementById('edit-subject');
            const selectedOption = subjectSelect.options[subjectSelect.selectedIndex];
            const subjectName = selectedOption.text;
            
            let mode = 'javascript'; // ê¸°ë³¸ê°’
            
            if (subjectName.includes('Python')) {
                mode = 'python';
            } else if (subjectName.includes('Java') || subjectName.includes('C++')) {
                mode = 'text/x-java';
            } else if (subjectName.includes('HTML') || subjectName.includes('CSS')) {
                mode = 'xml';
            } else if (subjectName.includes('SQL')) {
                mode = 'text/x-sql';
            }
            
            // ëª¨ë“  ìˆ˜ì • ëª¨ë‹¬ ì—ë””í„°ì˜ ëª¨ë“œ ì—…ë°ì´íŠ¸
            if (editQuestionEditor) {
                editQuestionEditor.setOption('mode', mode);
            }
            if (editExplanationEditor) {
                editExplanationEditor.setOption('mode', mode);
            }
            
            Object.values(editOptionEditors).forEach(editor => {
                if (editor) {
                    editor.setOption('mode', mode);
                }
            });
        }
        
        // ìˆ˜ì • ëª¨ë‹¬ìš© í¼ ë°ì´í„° ìˆ˜ì§‘
        function collectEditFormData(form) {
            const formData = new FormData(form);
            
            // ì½”ë“œ ì—ë””í„° ë‚´ìš© ìˆ˜ì§‘
            if (editQuestionEditor) {
                formData.set('question', editQuestionEditor.getValue());
            }
            if (editExplanationEditor) {
                formData.set('explanation', editExplanationEditor.getValue());
            }
            
            // ë³´ê¸° ë°ì´í„° ìˆ˜ì§‘ (ì½”ë“œ ì—ë””í„° ë˜ëŠ” ì¼ë°˜ ì…ë ¥)
            ['option_a', 'option_b', 'option_c', 'option_d'].forEach(option => {
                if (editOptionEditors[option]) {
                    // ì½”ë“œ ì—ë””í„°ê°€ í™œì„±í™”ëœ ê²½ìš°
                    formData.set(option, editOptionEditors[option].getValue());
                } else {
                    // ì¼ë°˜ í…ìŠ¤íŠ¸ ì…ë ¥ì¸ ê²½ìš°
                    const textarea = document.getElementById(`edit-${option}`);
                    if (textarea) {
                        formData.set(option, textarea.value);
                    }
                }
            });
            
            return formData;
        }
        
        // ë¬¸ì œ ì‚­ì œ
        async function deleteProblem(problemId) {
            if (!confirm('ì •ë§ë¡œ ì´ ë¬¸ì œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }
            
            try {
                const response = await fetch(`/api/admin/problems/${problemId}`, {
                    method: 'DELETE'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showMessage('ë¬¸ì œê°€ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    loadProblems();
                } else {
                    showMessage(data.message || 'ë¬¸ì œ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            } catch (error) {
                console.error('ë¬¸ì œ ì‚­ì œ ì˜¤ë¥˜:', error);
                showMessage('ë¬¸ì œ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ê³¼ëª© ëª©ë¡ ë¡œë“œ
        async function loadSubjectsList() {
            try {
                const response = await fetch('/api/admin/subjects');
                const data = await response.json();
                
                if (data.success) {
                    const subjectsList = document.getElementById('subjectsList');
                    subjectsList.innerHTML = data.subjects.map(subject => `
                        <div class="problem-item">
                            <div class="problem-info">
                                <h4>${subject.name} ${subject.is_public ? '<span style="color: #27ae60; font-size: 0.8em;">(ê³µê°œ)</span>' : '<span style="color: #e74c3c; font-size: 0.8em;">(ë¹„ê³µê°œ)</span>'}</h4>
                                <p>ì¹´í…Œê³ ë¦¬: ${subject.category || 'ê¸°íƒ€'} | ì„¤ëª…: ${subject.description || 'ì„¤ëª… ì—†ìŒ'} | ë¬¸ì œ ìˆ˜: ${subject.problem_count}ê°œ</p>
                            </div>
                            <div class="problem-actions">
                                <button class="btn-primary" onclick="editSubject(${subject.id})">ìˆ˜ì •</button>
                                <button class="${subject.is_public ? 'btn-secondary' : 'btn-primary'}" onclick="toggleSubjectPublicStatus(${subject.id}, ${!subject.is_public})">
                                    ${subject.is_public ? 'ë¹„ê³µê°œë¡œ ë³€ê²½' : 'ê³µê°œë¡œ ë³€ê²½'}
                                </button>
                                <button class="btn-danger" onclick="deleteSubject(${subject.id})" ${subject.problem_count > 0 ? 'disabled' : ''}>ì‚­ì œ</button>
                            </div>
                        </div>
                    `).join('');
                    
                    // ê³¼ëª© ìˆœì„œ ëª©ë¡ë„ ë¡œë“œ
                    loadSubjectsOrderList(data.subjects);
                }
            } catch (error) {
                console.error('ê³¼ëª© ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }

        // ê³¼ëª© ìˆœì„œ ëª©ë¡ ë¡œë“œ
        function loadSubjectsOrderList(subjects) {
            const subjectsOrderList = document.getElementById('subjectsOrderList');
            subjectsOrderList.innerHTML = subjects.map((subject, index) => `
                <div class="subject-order-item" data-id="${subject.id}" data-order="${subject.sort_order || index + 1}">
                    <div class="subject-order-handle">â‹®â‹®</div>
                    <div class="subject-order-info">
                        <h4>${subject.name} ${subject.is_public ? '<span style="color: #27ae60; font-size: 0.8em;">(ê³µê°œ)</span>' : '<span style="color: #e74c3c; font-size: 0.8em;">(ë¹„ê³µê°œ)</span>'}</h4>
                        <p>ì¹´í…Œê³ ë¦¬: ${subject.category || 'ê¸°íƒ€'} | ${subject.description || 'ì„¤ëª… ì—†ìŒ'} | ë¬¸ì œ ìˆ˜: ${subject.problem_count}ê°œ</p>
                    </div>
                    <div class="subject-order-number">${subject.sort_order || index + 1}</div>
                </div>
            `).join('');
            
            // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ê¸°ëŠ¥ ì´ˆê¸°í™”
            initDragAndDrop();
        }

        // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ê¸°ëŠ¥ ì´ˆê¸°í™”
        function initDragAndDrop() {
            const container = document.getElementById('subjectsOrderList');
            const items = container.querySelectorAll('.subject-order-item');
            
            items.forEach(item => {
                item.addEventListener('dragstart', handleDragStart);
                item.addEventListener('dragend', handleDragEnd);
                item.addEventListener('dragover', handleDragOver);
                item.addEventListener('drop', handleDrop);
                item.draggable = true;
            });
        }

        // ë“œë˜ê·¸ ì‹œì‘
        function handleDragStart(e) {
            e.target.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', e.target.outerHTML);
        }

        // ë“œë˜ê·¸ ì¢…ë£Œ
        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
        }

        // ë“œë˜ê·¸ ì˜¤ë²„
        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
        }

        // ë“œë¡­
        function handleDrop(e) {
            e.preventDefault();
            
            const draggingItem = document.querySelector('.dragging');
            const dropTarget = e.target.closest('.subject-order-item');
            
            if (draggingItem && dropTarget && draggingItem !== dropTarget) {
                const container = document.getElementById('subjectsOrderList');
                const items = Array.from(container.querySelectorAll('.subject-order-item'));
                const draggingIndex = items.indexOf(draggingItem);
                const dropIndex = items.indexOf(dropTarget);
                
                if (draggingIndex < dropIndex) {
                    dropTarget.parentNode.insertBefore(draggingItem, dropTarget.nextSibling);
                } else {
                    dropTarget.parentNode.insertBefore(draggingItem, dropTarget);
                }
                
                // ìˆœì„œ ë²ˆí˜¸ ì—…ë°ì´íŠ¸
                updateOrderNumbers();
            }
        }

        // ìˆœì„œ ë²ˆí˜¸ ì—…ë°ì´íŠ¸
        function updateOrderNumbers() {
            const items = document.querySelectorAll('.subject-order-item');
            items.forEach((item, index) => {
                const numberElement = item.querySelector('.subject-order-number');
                numberElement.textContent = index + 1;
                item.dataset.order = index + 1;
            });
        }

        // ê³¼ëª© ìˆœì„œ ì €ì¥
        async function saveSubjectsOrder() {
            try {
                const items = document.querySelectorAll('.subject-order-item');
                const subjects = Array.from(items).map((item, index) => ({
                    id: parseInt(item.dataset.id),
                    sort_order: index + 1
                }));
                
                const response = await fetch('/api/admin/subjects/order', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ subjects })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showMessage('ê³¼ëª© ìˆœì„œê°€ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    loadSubjectsList(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                } else {
                    showMessage(data.message || 'ê³¼ëª© ìˆœì„œ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            } catch (error) {
                console.error('ê³¼ëª© ìˆœì„œ ì €ì¥ ì˜¤ë¥˜:', error);
                showMessage('ê³¼ëª© ìˆœì„œ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ê³¼ëª© ì¶”ê°€
        async function addSubject(formData) {
            try {
                const response = await fetch('/api/admin/subjects', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name: formData.get('subject-name'),
                        description: formData.get('subject-description'),
                        category: formData.get('subject-category'),
                        is_public: formData.get('subject-public') === 'on'
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showMessage('ê³¼ëª©ì´ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    document.getElementById('addSubjectForm').reset();
                    loadSubjectsList();
                    loadSubjects(); // ë¬¸ì œ ì¶”ê°€ í¼ì˜ ê³¼ëª© ì„ íƒ ì˜µì…˜ë„ ì—…ë°ì´íŠ¸
                } else {
                    showMessage(data.message || 'ê³¼ëª© ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            } catch (error) {
                console.error('ê³¼ëª© ì¶”ê°€ ì˜¤ë¥˜:', error);
                showMessage('ê³¼ëª© ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ê³¼ëª© ìˆ˜ì • ëª¨ë‹¬ ì—´ê¸°
        async function editSubject(subjectId) {
            try {
                // ê³¼ëª© ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                const response = await fetch('/api/admin/subjects');
                const data = await response.json();
                
                if (!data.success) {
                    showMessage('ê³¼ëª© ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                    return;
                }
                
                const subject = data.subjects.find(s => s.id === subjectId);
                if (!subject) {
                    showMessage('ê³¼ëª©ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                    return;
                }
                
                // ëª¨ë‹¬ í•„ë“œì— ë°ì´í„° ì„¤ì •
                document.getElementById('edit-subject-id').value = subject.id;
                document.getElementById('edit-subject-name').value = subject.name;
                document.getElementById('edit-subject-description').value = subject.description || '';
                document.getElementById('edit-subject-category').value = subject.category || '';
                document.getElementById('edit-subject-public').checked = subject.is_public || false;
                
                // ëª¨ë‹¬ ì—´ê¸°
                document.getElementById('editSubjectModal').style.display = 'block';
                
            } catch (error) {
                console.error('ê³¼ëª© ì •ë³´ ë¡œë“œ ì˜¤ë¥˜:', error);
                showMessage('ê³¼ëª© ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }
        
        // ê³¼ëª© ìˆ˜ì • ëª¨ë‹¬ ë‹«ê¸°
        function closeEditSubjectModal() {
            document.getElementById('editSubjectModal').style.display = 'none';
        }
        
        // ê³¼ëª© ìˆ˜ì • ì œì¶œ
        async function submitEditSubject(formData) {
            try {
                const subjectId = document.getElementById('edit-subject-id').value;
                
                const response = await fetch(`/api/admin/subjects/${subjectId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name: formData.get('subject-name'),
                        description: formData.get('subject-description'),
                        category: formData.get('subject-category'),
                        is_public: formData.get('subject-public') === 'on'
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showMessage('ê³¼ëª©ì´ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    closeEditSubjectModal();
                    loadSubjectsList(); // ê³¼ëª© ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                    loadSubjects(); // ë¬¸ì œ ì¶”ê°€ í¼ì˜ ê³¼ëª© ì„ íƒ ì˜µì…˜ë„ ì—…ë°ì´íŠ¸
                } else {
                    showMessage(data.message || 'ê³¼ëª© ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            } catch (error) {
                console.error('ê³¼ëª© ìˆ˜ì • ì˜¤ë¥˜:', error);
                showMessage('ê³¼ëª© ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ê³¼ëª© ê³µê°œ/ë¹„ê³µê°œ ìƒíƒœ í† ê¸€
        async function toggleSubjectPublicStatus(subjectId, isPublic) {
            const statusText = isPublic ? 'ê³µê°œ' : 'ë¹„ê³µê°œ';
            if (!confirm(`ì •ë§ë¡œ ì´ ê³¼ëª©ì„ ${statusText}ë¡œ ì„¤ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                return;
            }
            
            try {
                const response = await fetch(`/api/admin/subjects/${subjectId}/public-status`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ is_public: isPublic })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showMessage(data.message, 'success');
                    loadSubjectsList();
                    loadSubjects(); // ë¬¸ì œ ì¶”ê°€ í¼ì˜ ê³¼ëª© ì„ íƒ ì˜µì…˜ë„ ì—…ë°ì´íŠ¸
                } else {
                    showMessage(data.message || 'ê³¼ëª© ìƒíƒœ ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            } catch (error) {
                console.error('ê³¼ëª© ìƒíƒœ ë³€ê²½ ì˜¤ë¥˜:', error);
                showMessage('ê³¼ëª© ìƒíƒœ ë³€ê²½ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ê³¼ëª© ì‚­ì œ
        async function deleteSubject(subjectId) {
            if (!confirm('ì •ë§ë¡œ ì´ ê³¼ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }
            
            try {
                const response = await fetch(`/api/admin/subjects/${subjectId}`, {
                    method: 'DELETE'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showMessage('ê³¼ëª©ì´ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    loadSubjectsList();
                    loadSubjects(); // ë¬¸ì œ ì¶”ê°€ í¼ì˜ ê³¼ëª© ì„ íƒ ì˜µì…˜ë„ ì—…ë°ì´íŠ¸
                } else {
                    showMessage(data.message || 'ê³¼ëª© ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            } catch (error) {
                console.error('ê³¼ëª© ì‚­ì œ ì˜¤ë¥˜:', error);
                showMessage('ê³¼ëª© ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
        async function changePassword(formData) {
            const newPassword = formData.get('new-password');
            const confirmPassword = formData.get('confirm-password');
            
            if (newPassword !== confirmPassword) {
                showMessage('ìƒˆ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.', 'error');
                return;
            }
            
            try {
                const response = await fetch('/api/auth/change-password', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        currentPassword: formData.get('current-password'),
                        newPassword: newPassword
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showMessage('ë¹„ë°€ë²ˆí˜¸ê°€ ì„±ê³µì ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    document.getElementById('changePasswordForm').reset();
                } else {
                    showMessage(data.message || 'ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            } catch (error) {
                console.error('ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì˜¤ë¥˜:', error);
                showMessage('ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ë©”ì‹œì§€ í‘œì‹œ
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.innerHTML = `<div class="${type}-message">${message}</div>`;
            
            setTimeout(() => {
                messageContainer.innerHTML = '';
            }, 3000);
        }

        // ë¡œê·¸ì•„ì›ƒ
        async function logout() {
            try {
                const response = await fetch('/api/auth/logout', {
                    method: 'POST'
                });
                window.location.href = '/';
            } catch (error) {
                console.error('ë¡œê·¸ì•„ì›ƒ ì˜¤ë¥˜:', error);
            }
        }

        // CodeMirror ì—ë””í„° ì¸ìŠ¤í„´ìŠ¤ë“¤
        let questionEditor = null;
        let explanationEditor = null;
        let optionEditors = {};
        
        // ìˆ˜ì • ëª¨ë‹¬ìš© CodeMirror ì—ë””í„° ì¸ìŠ¤í„´ìŠ¤ë“¤
        let editQuestionEditor = null;
        let editExplanationEditor = null;
        let editOptionEditors = {};

        // ì½”ë“œ ì—ë””í„° ì´ˆê¸°í™”
        function initCodeEditors() {
            // ë¬¸ì œ ì—ë””í„°
            questionEditor = CodeMirror.fromTextArea(document.getElementById('question'), {
                mode: 'javascript',
                theme: 'monokai',
                lineNumbers: true,
                autoCloseBrackets: true,
                matchBrackets: true,
                indentUnit: 4,
                tabSize: 4,
                lineWrapping: true
            });

            // í•´ì„¤ ì—ë””í„°
            explanationEditor = CodeMirror.fromTextArea(document.getElementById('explanation'), {
                mode: 'javascript',
                theme: 'monokai',
                lineNumbers: true,
                autoCloseBrackets: true,
                matchBrackets: true,
                indentUnit: 4,
                tabSize: 4,
                lineWrapping: true
            });

            // ë³´ê¸° ì—ë””í„°ë“¤ì€ í•„ìš”í•  ë•Œ ë™ì ìœ¼ë¡œ ìƒì„±ë¨
        }

        // ê³¼ëª©ì— ë”°ë¥¸ ì½”ë“œ ëª¨ë“œ ì—…ë°ì´íŠ¸
        function updateCodeMode() {
            const subjectSelect = document.getElementById('subject');
            const selectedOption = subjectSelect.options[subjectSelect.selectedIndex];
            const subjectName = selectedOption.text;
            
            let mode = 'javascript'; // ê¸°ë³¸ê°’
            
            if (subjectName.includes('Python')) {
                mode = 'python';
            } else if (subjectName.includes('Java') || subjectName.includes('C++')) {
                mode = 'text/x-java';
            } else if (subjectName.includes('HTML') || subjectName.includes('CSS')) {
                mode = 'xml';
            } else if (subjectName.includes('SQL')) {
                mode = 'text/x-sql';
            }
            
            // ëª¨ë“  ì—ë””í„°ì˜ ëª¨ë“œ ì—…ë°ì´íŠ¸
            if (questionEditor) {
                questionEditor.setOption('mode', mode);
            }
            if (explanationEditor) {
                explanationEditor.setOption('mode', mode);
            }
            
            Object.values(optionEditors).forEach(editor => {
                if (editor) {
                    editor.setOption('mode', mode);
                }
            });
        }

        // ì½”ë“œ ì—ë””í„° í† ê¸€
        function toggleCodeEditor(field) {
            const container = document.getElementById(field).parentElement;
            const textarea = document.getElementById(field);
            const button = container.querySelector('button');
            
            if (textarea.style.display === 'none') {
                // í…ìŠ¤íŠ¸ ì—ë””í„°ë¡œ ì „í™˜
                textarea.style.display = 'block';
                textarea.removeAttribute('disabled');
                if (field === 'question' && questionEditor) {
                    questionEditor.toTextArea();
                    questionEditor = null;
                } else if (field === 'explanation' && explanationEditor) {
                    explanationEditor.toTextArea();
                    explanationEditor = null;
                } else if (optionEditors[field]) {
                    optionEditors[field].toTextArea();
                    optionEditors[field] = null;
                }
                button.textContent = 'ì½”ë“œ ì—ë””í„°';
            } else {
                // ì½”ë“œ ì—ë””í„°ë¡œ ì „í™˜
                textarea.style.display = 'none';
                textarea.setAttribute('disabled', 'disabled');
                if (field === 'question') {
                    questionEditor = CodeMirror.fromTextArea(textarea, {
                        mode: 'javascript',
                        theme: 'monokai',
                        lineNumbers: true,
                        autoCloseBrackets: true,
                        matchBrackets: true,
                        indentUnit: 4,
                        tabSize: 4,
                        lineWrapping: true
                    });
                } else if (field === 'explanation') {
                    explanationEditor = CodeMirror.fromTextArea(textarea, {
                        mode: 'javascript',
                        theme: 'monokai',
                        lineNumbers: true,
                        autoCloseBrackets: true,
                        matchBrackets: true,
                        indentUnit: 4,
                        tabSize: 4,
                        lineWrapping: true
                    });
                } else if (['option_a', 'option_b', 'option_c', 'option_d'].includes(field)) {
                    optionEditors[field] = CodeMirror.fromTextArea(textarea, {
                        mode: 'javascript',
                        theme: 'monokai',
                        lineNumbers: true,
                        autoCloseBrackets: true,
                        matchBrackets: true,
                        indentUnit: 4,
                        tabSize: 4,
                        lineWrapping: true
                    });
                }
                button.textContent = 'í…ìŠ¤íŠ¸ ì—ë””í„°';
            }
        }



        // í¼ ë°ì´í„° ìˆ˜ì§‘ (ì½”ë“œ ì—ë””í„° ë‚´ìš© í¬í•¨)
        function collectFormData(form) {
            const formData = new FormData(form);
            
            // ì½”ë“œ ì—ë””í„° ë‚´ìš© ìˆ˜ì§‘
            if (questionEditor) {
                formData.set('question', questionEditor.getValue());
            }
            if (explanationEditor) {
                formData.set('explanation', explanationEditor.getValue());
            }
            
            // ë³´ê¸° ë°ì´í„° ìˆ˜ì§‘ (ì½”ë“œ ì—ë””í„° ë˜ëŠ” ì¼ë°˜ ì…ë ¥)
            ['option_a', 'option_b', 'option_c', 'option_d'].forEach(option => {
                if (optionEditors[option]) {
                    // ì½”ë“œ ì—ë””í„°ê°€ í™œì„±í™”ëœ ê²½ìš°
                    formData.set(option, optionEditors[option].getValue());
                } else {
                    // ì¼ë°˜ í…ìŠ¤íŠ¸ ì…ë ¥ì¸ ê²½ìš°
                    const textarea = document.getElementById(option);
                    if (textarea) {
                        formData.set(option, textarea.value);
                    }
                }
            });
            
            // subjectë¥¼ subject_idë¡œ ë³€ê²½
            const subjectValue = formData.get('subject');
            formData.delete('subject');
            formData.set('subject_id', subjectValue);
            
            return formData;
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.addEventListener('DOMContentLoaded', () => {
            checkAdminAuth();
            loadSubjects();
            loadDashboardStats();
            loadProblems(); // ë¬¸ì œ ëª©ë¡ ë¡œë“œ
            
            // ì½”ë“œ ì—ë””í„° ì´ˆê¸°í™”
            initCodeEditors();
            
            // ë¬¸ì œ ì¶”ê°€ í¼ ì œì¶œ
            document.getElementById('addProblemForm').addEventListener('submit', (e) => {
                e.preventDefault();
                const formData = collectFormData(e.target);
                addProblem(formData);
            });
            
            // ê³¼ëª© ì¶”ê°€ í¼ ì œì¶œ
            document.getElementById('addSubjectForm').addEventListener('submit', (e) => {
                e.preventDefault();
                const formData = new FormData(e.target);
                addSubject(formData);
            });
            
            // ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ í¼ ì œì¶œ
            document.getElementById('changePasswordForm').addEventListener('submit', (e) => {
                e.preventDefault();
                const formData = new FormData(e.target);
                changePassword(formData);
            });
            
            // ë¬¸ì œ ìˆ˜ì • í¼ ì œì¶œ
            document.getElementById('editProblemForm').addEventListener('submit', (e) => {
                e.preventDefault();
                const formData = collectEditFormData(e.target);
                submitEditProblem(formData);
            });
            
            // ê³¼ëª© ìˆ˜ì • í¼ ì œì¶œ
            document.getElementById('editSubjectForm').addEventListener('submit', (e) => {
                e.preventDefault();
                const formData = new FormData(e.target);
                submitEditSubject(formData);
            });
            
            // ê²€ìƒ‰ì°½ì—ì„œ Enter í‚¤ ì´ë²¤íŠ¸
            document.getElementById('problemSearch').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    searchProblems();
                }
            });
            
            // ì‹¤ì‹œê°„ ê²€ìƒ‰ (ì…ë ¥ ì‹œë§ˆë‹¤)
            document.getElementById('problemSearch').addEventListener('input', () => {
                clearTimeout(window.searchTimeout);
                window.searchTimeout = setTimeout(searchProblems, 300); // 300ms ë”œë ˆì´
            });
            
            // í˜ì´ì§€ ì´ë™ ì…ë ¥ì°½ì—ì„œ Enter í‚¤ ì´ë²¤íŠ¸
            document.getElementById('gotoPage').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    goToPageInput();
                }
            });
        });
    </script>
</body>
</html> 