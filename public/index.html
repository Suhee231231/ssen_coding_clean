<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SSEN CODING</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    <link rel="apple-touch-icon" href="/favicon.ico">
    <link rel="stylesheet" href="/css/style.css?v=1.1">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Asta+Sans:wght@300..800&display=swap" rel="stylesheet">
    <script>
      (function(d) {
        var config = {
          kitId: 'web7wnn',
          scriptTimeout: 3000,
          async: true
        },
        h=d.documentElement,t=setTimeout(function(){h.className=h.className.replace(/\bwf-loading\b/g,"")+" wf-inactive";},config.scriptTimeout),tk=d.createElement("script"),f=false,s=d.getElementsByTagName("script")[0],a;h.className+=" wf-loading";tk.src='https://use.typekit.net/'+config.kitId+'.js';tk.async=true;tk.onload=tk.onreadystatechange=function(){a=this.readyState;if(f||a&&a!="complete"&&a!="loaded")return;f=true;clearTimeout(t);try{Typekit.load(config)}catch(e){}};s.parentNode.insertBefore(tk,s)
      })(document);
    </script>
</head>
<body>
    <header>
        <nav>
            <div class="nav-container">
                <h1 class="logo"><a href="/" style="text-decoration: none; color: inherit;"><span class="logo-highlight">SSEN</span><span class="logo-underline">C</span>ODING</a></h1>
                <div class="nav-links" id="navLinks">
                    <!-- JavaScript로 동적 생성 -->
                </div>
            </div>
        </nav>
    </header>
    <main>
        <section class="hero">
            <div class="hero-content">
                <h1>4지 선다형 문제로 익히는 코딩</h1>
                <p class="hero-main-text" style="font-weight: normal;">문제를 풀기 위한 선수 지식이 없어도 괜찮습니다. 문제를 풀며 자연스럽게 개념과 문법을 익힐 수 있습니다.</p>
                <p class="hero-main-text" style="font-weight: normal;">과목은 지속적으로 추가, 업데이트됩니다.</p>
                <div class="hero-stats">
                    <div class="stat">
                        <span class="stat-number" id="totalProblems">로딩중...</span>
                        <span class="stat-label">문제</span>
                    </div>
                    <div class="stat">
                        <span class="stat-number" id="totalSubjects">로딩중...</span>
                        <span class="stat-label">과목</span>
                    </div>
                    <div class="stat">
                        <span class="stat-number" id="latestUpdate">로딩중...</span>
                        <span class="stat-label">최종수정일</span>
                    </div>
                </div>
            </div>
        </section>
        <section class="subjects">
            <div class="container">
                <div class="subject-grid" id="subjectGrid">
                    <!-- JavaScript로 동적 생성 -->
                </div>
            </div>
        </section>

    </main>
    <footer>
        <div class="container">
            <p>&copy; SSEN CODING. All Rights Reserved.</p>
            <p>Contact: ssencoding@gmail.com</p>
        </div>
    </footer>

    <script>
        // 세션 상태 확인 및 네비게이션 업데이트
        async function checkAuthStatus() {
            try {
                const response = await fetch('/api/auth/check');
                const data = await response.json();
                
                const navLinks = document.getElementById('navLinks');
                
                if (data.isLoggedIn) {
                    let navHTML = `<a href="/profile.html">내 학습</a>`;
                    if (data.isAdmin) {
                        navHTML += `<a href="/admin.html">관리자</a>`;
                    }
                    navHTML += `<a href="#" onclick="logout()">로그아웃</a>`;
                    navLinks.innerHTML = navHTML;
                } else {
                    navLinks.innerHTML = `
                        <a href="#" onclick="showLoginPrompt()">내 학습</a>
                        <a href="/login.html" title="학습 진행상황을 저장하고 틀린 문제들만 다시 풀어볼 수 있습니다.">로그인</a>
                        <a href="/register.html" title="학습 진행상황을 저장하고 틀린 문제들만 다시 풀어볼 수 있습니다.">회원가입</a>
                    `;
                }
            } catch (error) {
                console.error('인증 상태 확인 오류:', error);
            }
        }

        // 로그인 안내 메시지 표시
        function showLoginPrompt() {
            if (confirm('로그인 시 이용 가능합니다.\n진행상황 저장 및 틀린 문제 다시풀기 등이 가능합니다.\n\n로그인 페이지로 이동하시겠습니까?')) {
                window.location.href = '/login.html';
            }
        }

        // 로그아웃
        async function logout() {
            try {
                const response = await fetch('/api/auth/logout', {
                    method: 'POST'
                });
                const data = await response.json();
                
                if (data.success) {
                    window.location.href = '/';
                }
            } catch (error) {
                console.error('로그아웃 오류:', error);
            }
        }

        // 통계 데이터 로드
        async function loadStats() {
            try {
                const response = await fetch('/api/problems/subjects');
                const data = await response.json();
                
                if (data.success) {
                    // 과목 수 계산
                    const totalSubjects = data.subjects.length;
                    
                    // 전체 문제 수 계산
                    const totalProblems = data.subjects.reduce((sum, subject) => {
                        return sum + (subject.total_problems || 0);
                    }, 0);
                    
                    // 최신 수정일 포맷팅
                    console.log('API 응답의 latestUpdate:', data.latestUpdate);
                    let latestUpdateText = '업데이트 없음';
                    if (data.latestUpdate) {
                        const updateDate = new Date(data.latestUpdate);
                        console.log('파싱된 날짜:', updateDate);
                        latestUpdateText = updateDate.toLocaleDateString('ko-KR', {
                            year: 'numeric',
                            month: '2-digit',
                            day: '2-digit'
                        });
                        console.log('포맷된 날짜:', latestUpdateText);
                    }
                    
                    document.getElementById('totalProblems').textContent = totalProblems;
                    document.getElementById('totalSubjects').textContent = totalSubjects;
                    document.getElementById('latestUpdate').textContent = latestUpdateText;
                }
            } catch (error) {
                console.error('통계 로드 오류:', error);
                // 에러 시 기본값 표시
                document.getElementById('totalProblems').textContent = '0';
                document.getElementById('totalSubjects').textContent = '0';
                document.getElementById('latestUpdate').textContent = '오류';
            }
        }

        // 과목 목록 로드
        async function loadSubjects() {
            try {
                const response = await fetch('/api/problems/subjects');
                const data = await response.json();
                
                if (data.success) {
                    const subjectGrid = document.getElementById('subjectGrid');
                    subjectGrid.innerHTML = data.subjects.map(subject => `
                        <div class="subject-card" onclick="location.href='/problems.html?subject=${encodeURIComponent(subject.name)}'">
                            <div class="card-cover">
                                <div class="card-header">
                                    <span>${subject.category || '기타'}</span>
                                </div>
                                <div class="card-content">
                                    <h3>${subject.name}</h3>
                                    <p>${subject.description}</p>
                                    <div class="card-stats">
                                        <span>${subject.total_problems}문제</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `).join('');
                }
            } catch (error) {
                console.error('과목 로드 오류:', error);
            }
        }



        // 페이지 로드 시 실행
        document.addEventListener('DOMContentLoaded', () => {
            checkAuthStatus();
            loadStats();
            loadSubjects();
        });
    </script>
</body>
</html> 